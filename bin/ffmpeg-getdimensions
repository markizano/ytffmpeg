#!/usr/bin/env python3

import os, sys, io
import json
import subprocess

sys.argv.pop(0)
for filename in sys.argv:
  ffjson = json.loads( subprocess.check_output( 'ffprobe -v quiet -print_format json -show_format -show_streams'.split(' ') + [filename]).decode('utf-8') )
  width, height, sar, dar, rotate, rotation = (0, 0, '0:0', '0:0', 0, 0 )
  for stream in ffjson['streams']:
    if 'width' in stream:
      width = stream['width']
    if 'height' in stream:
      height = stream['height']
    if 'sample_aspect_ratio' in stream:
      sar = stream['sample_aspect_ratio']
    if 'display_aspect_ratio' in stream:
      dar = stream['display_aspect_ratio']
    if 'tags' in stream:
      if 'rotate' in stream['tags']:
        rotate = int(stream['tags']['rotate'])
    if 'side_data_list' in stream:
      if 'rotation' in stream['side_data_list']:
        rotation = int(stream['side_data_list']['rotation'])

  print(f'{filename}: {width}x{height}; {sar}, {dar}, r={rotate}/{rotation}')

